global:
  scrape_interval: 15s

rule_files:
  - "alerts.rule.yml"

scrape_configs:
{% for svc in all_docker_services %}
{% if svc.metrics_enabled | default(false) %}
  - job_name: "{{ svc.metrics_job_name | default(svc.name) }}"
    scrape_interval: {{ svc.metrics_interval | default('30s') }}
{% if svc.metrics_path is defined %}
    metrics_path: {{ svc.metrics_path }}
{% endif %}
    static_configs:
      - targets: ["{{ svc.ip }}:{{ svc.metrics_port | default(svc.port) }}"]
{% endif %}
{% endfor %}
  - job_name: "prometheus"
    scrape_interval: 5s
    static_configs:
      - targets: ["localhost:9090"]
