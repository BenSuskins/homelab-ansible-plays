---
server:
  address: 'tcp://0.0.0.0:9091'
  buffers:
    read: 4096
    write: 4096
  timeouts:
    read: '6s'
    write: '6s'
    idle: '30s'

log:
  level: info
  format: text

theme: light

totp:
  disable: true

webauthn:
  disable: false
  display_name: Homelab
  attestation_conveyance_preference: indirect
  timeout: 60s

authentication_backend:
  password_reset:
    disable: false
  file:
    path: /config/users_database.yml
    watch: true
    password:
      algorithm: argon2
      argon2:
        variant: argon2id
        iterations: 3
        memory: 65536
        parallelism: 4
        key_length: 32
        salt_length: 16

access_control:
  default_policy: deny
  rules:
    - domain:
        - "pve.{{ domain }}"
        - "grafana.{{ domain }}"
        - "games.{{ domain }}"
      policy: two_factor
      subject:
        - "group:Suskins Admin"

    - domain: "*.{{ domain }}"
      policy: two_factor

session:
  cookies:
    - domain: "{{ domain }}"
      authelia_url: "https://authelia.{{ domain }}"
      name: authelia_session
      same_site: lax
      expiration: 1h
      inactivity: 5m
      remember_me: 1M

regulation:
  max_retries: 3
  find_time: 2m
  ban_time: 5m

storage:
  local:
    path: /config/db.sqlite3

notifier:
  disable_startup_check: true
  filesystem:
    filename: /config/notification.txt

identity_providers:
  oidc:
    lifespans:
      access_token: 1h
      authorize_code: 1m
      id_token: 1h
      refresh_token: 90m
    enable_client_debug_messages: false
    enforce_pkce: public_clients_only
    cors:
      endpoints:
        - authorization
        - token
        - revocation
        - introspection
      allowed_origins_from_client_redirect_uris: true

    clients:
      - client_id: family-hub
        client_name: Family Hub
        client_secret: '{{ AUTHELIA_OIDC_HUB_SECRET }}'
        public: false

        redirect_uris:
          - https://hub.suskins.co.uk/auth/callback

        scopes:
          - openid
          - profile
          - email

        grant_types:
          - authorization_code

        response_types:
          - code

        token_endpoint_auth_method: client_secret_basic

      - client_id: gatus
        client_name: Gatus
        client_secret: '{{ AUTHELIA_OIDC_GATUS_SECRET }}'
        public: false
        authorization_policy: two_factor
        redirect_uris:
          - 'https://gatus.{{ domain }}/authorization-code/callback'
        scopes:
          - 'openid'
          - 'profile'
          - 'email'
        response_types:
          - 'code'
        grant_types:
          - 'authorization_code'
        access_token_signed_response_alg: 'none'
        userinfo_signed_response_alg: 'none'
        token_endpoint_auth_method: 'client_secret_basic'

      - client_id: grafana
        client_name: Grafana
        client_secret: '{{ AUTHELIA_OIDC_GRAFANA_SECRET }}'
        public: false
        authorization_policy: 'two_factor'
        require_pkce: true
        pkce_challenge_method: 'S256'
        redirect_uris:
          - 'https://grafana.{{ domain }}/login/generic_oaut'
        scopes:
          - 'openid'
          - 'profile'
          - 'groups'
          - 'email'
        response_types:
          - 'code'
        grant_types:
          - 'authorization_code'
        access_token_signed_response_alg: 'none'
        userinfo_signed_response_alg: 'none'
        token_endpoint_auth_method: 'client_secret_basic'


      - client_id: mealie
        client_name: Mealie
        client_secret: '{{ AUTHELIA_OIDC_MEALIE_SECRET }}'
        public: false
        authorization_policy: two_factor
        redirect_uris:
          - 'https://mealie.{{ domain }}/login'
        scopes:
          - 'openid'
          - 'email'
          - 'profile'
          - 'groups'
        response_types:
          - 'code'
        grant_types:
          - 'authorization_code'
        access_token_signed_response_alg: 'none'
        userinfo_signed_response_alg: 'none'
        token_endpoint_auth_method: 'client_secret_basic'

      - client_id: homeassistant
        client_name: Home Assistant
        client_secret: '{{ AUTHELIA_OIDC_HOMEASSISTANT_SECRET }}'
        public: false
        authorization_policy: two_factor
        redirect_uris:
          - 'https://homeassistant.{{ domain }}/auth/external/callback'
        scopes:
          - openid
          - profile
          - email
        userinfo_signed_response_alg: none
        token_endpoint_auth_method: client_secret_post

      - client_id: proxmox
        client_name: Proxmox
        client_secret: '{{ AUTHELIA_OIDC_PROXMOX_SECRET }}'
        public: false
        authorization_policy: two_factor
        redirect_uris:
          - 'https://pve.{{ domain }}'
        scopes:
          - openid
          - profile
          - email
        userinfo_signed_response_alg: none
        token_endpoint_auth_method: client_secret_post

      - client_id: hub
        client_name: Hub
        client_secret: '{{ AUTHELIA_OIDC_HUB_SECRET }}'
        public: false
        authorization_policy: two_factor
        redirect_uris:
          - 'https://hub.{{ domain }}/auth/callback'
        scopes:
          - openid
          - profile
          - email
        userinfo_signed_response_alg: none
        token_endpoint_auth_method: client_secret_post
