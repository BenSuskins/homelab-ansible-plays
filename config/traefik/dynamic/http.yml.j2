http:
  routers:
{% for svc in static_services %}
    {{ svc.name }}:
      rule: "Host(`{{ svc.host }}`)"
      entryPoints:
        - websecure
      middlewares:
        {% if svc.secured is not defined or svc.secured %}- authentik{% endif %}
        - ratelimit
      tls:
        {% if svc.tls is defined %}
        store: "{{ svc.tls }}"
        {% else %}
        certResolver: "default"
        {% endif %}
      service: "{{ svc.name }}"
{% endfor %}

{% for svc in all_services %}
    {{ svc.container }}:
      rule: "Host(`{{ svc.container }}.suskins.co.uk`)"
      entryPoints:
        - websecure
      middlewares:
        {% if svc.secured is not defined or svc.secured %}- authentik{% endif %}
        - ratelimit
      tls:
        {% if svc.tls is defined %}
        store: "{{ svc.tls }}"
        {% else %}
        certResolver: "default"
        {% endif %}
      service: "{{ svc.container }}"
{% endfor %}

  services:
{% for svc in static_services %}
    {{ svc.name }}:
      loadBalancer:
        {% if svc.scheme is defined and svc.scheme == "https" %}
        serversTransport: httpsTransport
        {% endif %}
        servers:
          - url: "{{ svc.scheme | default('http') }}://{{ svc.ip }}:{{ svc.port }}"
{% endfor %}

{% for svc in all_services %}
    {{ svc.container }}:
      loadBalancer:
        {% if svc.scheme is defined and svc.scheme == "https" %}
        serversTransport: httpsTransport
        {% endif %}
        servers:
          - url: "{{ svc.scheme | default('http') }}://{{ svc.ip }}:{{ svc.port }}"
{% endfor %}

serversTransports:
  httpsTransport:
    insecureSkipVerify: true